{"version":3,"sources":["../src/main.js"],"names":["define","$","ModalFactory","ModalEvents","Templates","$errorBox","boasearch","el","params","$boasearch","$boasearchBox","$boasearchSuggestions","cacheResults","requestObjects","startRecord","wrap","parent","append","customReset","empty","hide","data","options","extend","defaults","events","results","conf","attr","ferror","txt","level","debug","console","log","methods","init","apiuri","on","event","keyCode","preventDefault","previousItemMarkup","nextItemMarkup","val","specialKeys","length","indexOf","minLetters","printSuggestions","search","window","setTimeout","getItemMarkup","item","query","text","highlightString","$item","$this","str","n","toLowerCase","before","substr","word","after","$current","find","oldposition","newposition","index","removeClass","$new","children","eq","addClass","printItemsMarkup","title","each","k","show","initSearch","onstart","target","printResultSearch","onfound","$target","$html","preview","choosePreview","about","metadata","general","none","description","manifest","entrypoint","alternatebase","id","alterpath","alternate","request","abort","uri","suggestionsSize","filters","join","filter","get","sort","a","b","size","currentTime","Date","now","timeQuery","cacheLife","resultsSize","value","m","meta","ajax","url","dataType","success","error","onerror","xhr","responseText","parseJSON","fail","searchMore","restart","catalogues","template","fn","paramval","chooseview","$res","conexion_type","$reslink","html","outerHTML","technical","format","match","src","name","e","test","customicon","isdownloadable","showmessage","type","info","asreturn","content","innerHTML","replace","itemcontent","thumb","social","comments","score","count","sum","views","blockid","boauri","pagesize","socialnetworks","$_this","$searchResult","$boaSearch","more","start","finaluri","appendTo","modalresource","then","custom","avg","downloadable","socialnetworksitems","i","v","encodeURI","icon","push","alternates","alt","strkey","substring","M","block_boasearch","one","keywords","render","setTitle","$rate","post","done","key","element","$element","promise","create","body","modal","getModal","root","getRoot","hidden","getBody","pause","$iframe","$node","message","remove"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the block.\n *\n * @package   block_boasearch\n * @copyright 2020 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates'],\n        function($, ModalFactory, ModalEvents, Templates) {\n\n    // var wwwroot = M.cfg.wwwroot;\n\n    var $errorBox = null;\n\n    $.boasearch = function(el, params) {\n        var $boasearch = $(el);\n        var $boasearchBox;\n        var $boasearchSuggestions = $('<ul class=\"boasearch-suggestions\"></ul>');\n        var cacheResults = [];\n        var requestObjects = [];\n        var startRecord = 0;\n\n        $boasearch.wrap('<span class=\"boasearch-box\"></span>');\n\n        $boasearchBox = $boasearch.parent();\n        $boasearchBox.append($boasearchSuggestions);\n\n        $boasearchSuggestions.customReset = function() {\n            $boasearchSuggestions.empty();\n            $boasearchSuggestions.hide();\n            $boasearchSuggestions.data('off', true);\n        };\n\n        $boasearchSuggestions.customReset();\n\n        if (params.options) {\n            params.options = $.extend({}, $.boasearch.defaults.options, params.options);\n        }\n\n        if (params.events) {\n            params.events = $.extend({}, $.boasearch.defaults.events, params.events);\n        }\n\n        if (params.results) {\n            params.results = $.extend({}, $.boasearch.defaults.results, params.results);\n        }\n\n        $boasearch.conf = $.extend({}, $.boasearch.defaults, params);\n\n        $boasearch.attr('autocomplete', 'off');\n\n        var ferror = function(txt, level) {\n            switch(level) {\n                case 'dev':\n                    if ($boasearch.conf.debug) {\n                        console.log('BoASearch - ' + txt);\n                    }\n                break;\n                default:\n                    console.log('BoASearch - ' + txt);\n            }\n        };\n\n        // Store a reference to the BoASearch object\n        $.data(el, \"boasearch\", $boasearch);\n\n        // Private methods\n        var methods = {\n            init: function() {\n                if (!$boasearch.conf.apiuri) {\n                    ferror('Configuration error: You need set the API URI.');\n                    return;\n                }\n\n                $boasearch.on('keypress', function(event) {\n                    if (event.keyCode) {\n                        switch(event.keyCode) {\n                            case 13: // Enter\n                                event.preventDefault();\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 27: // Escape\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 38: // Up\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.previousItemMarkup();\n                                }\n                                break;\n                            case 40: // Down\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.nextItemMarkup();\n                                }\n                                break;\n                        }\n                    }\n                });\n\n                $boasearch.on('keyup', function(event) {\n                    var val = $boasearch.val();\n\n                    var specialKeys = [13, 16, 17, 18, 27, 33, 34, 35, 36, 37, 38, 39, 45, 144];\n                    if (!$boasearchSuggestions.data('off')) {\n                        specialKeys[specialKeys.length] = 40;\n                    }\n\n                    if (event.keyCode && specialKeys.indexOf(event.keyCode) == -1) {\n                        if (val.length >= $boasearch.conf.options.minLetters) {\n                            $boasearch.printSuggestions(val);\n                        }\n                        else {\n                            $boasearchSuggestions.customReset();\n                        }\n                    }\n                    else if (event.keyCode === 13) {\n                        $boasearch.search();\n                    }\n                });\n\n                $boasearchBox.on('focusout', function() {\n                    window.setTimeout(function() {\n                        $boasearchSuggestions.customReset();\n                    }, 100);\n                });\n            },\n\n            /**\n            * Build a suggestion item\n            * @param item the current item data to render\n            * @param query the last query submited to the server.\n            * */\n            getItemMarkup: function(item, query) {\n                var text = item.query != '' ? methods.highlightString(item.query, query) : '';\n\n                var $item = $('<li>' + text + '</li>');\n\n                $item.on('click', function(){\n                    var $this = $(this);\n                    $boasearchSuggestions.customReset();\n                    $boasearch.val($this.text());\n                });\n\n                return $item;\n            },\n\n            highlightString: function(str, query) {\n                var n = str.toLowerCase().indexOf(query.toLowerCase());\n                if (n >= 0) {\n                    var before = str.substr(0, n);\n                    var word   = str.substr(n, query.length);\n                    var after  = str.substr(n + query.length);\n\n                    str = before + '<em>' + word + '</em>' + after;\n                }\n                return str;\n            },\n\n            nextItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                }\n                else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition + 1;\n\n                if ($boasearchSuggestions.find('> li').length <= newposition) {\n                    newposition = 0;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            previousItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                }\n                else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition - 1;\n\n                if (newposition < 0) {\n                    newposition = $boasearchSuggestions.find('> li').length - 1;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            printItemsMarkup: function(title, data, query) {\n\n                if (data.length > 0) {\n                    $.each(data, function(k, item){\n                        var $item = methods.getItemMarkup(item, query, k);\n                        $boasearchSuggestions.append($item);\n                    });\n\n                    $boasearchSuggestions.show();\n                    $boasearchSuggestions.data('off', false);\n                }\n            },\n\n            initSearch: function() {\n                if (typeof($boasearch.conf.events.onstart) == 'function') {\n                    $boasearch.conf.events.onstart(startRecord > 0);\n                }\n                else {\n                    if ($boasearch.conf.results.target) {\n                        $($boasearch.conf.results.target).addClass('loading');\n                        if (startRecord === 0) {\n                            $($boasearch.conf.results.target).empty();\n                        }\n                    }\n                }\n            },\n\n            printResultSearch: function(data) {\n\n                if (typeof($boasearch.conf.events.onfound) == 'function') {\n                    $boasearch.conf.events.onfound(data, startRecord);\n                }\n                else {\n                    if ($boasearch.conf.results.target) {\n                        var $target = $($boasearch.conf.results.target);\n                        $target.removeClass('loading');\n\n                        $.each(data, function(k, item) {\n                            var $html = $('<div class=\"boa-video\"></div>');\n                            var preview = this.choosePreview(item);\n                            $html.append('<a href=\"' + item.about + '\"><h5>' + item.metadata.general.title.none + '</h5></a>');\n                            $html.append('<a href=\"' + item.about + '\"><img src=\"' + preview + '.img\" /></a>');\n                            $html.append('<p>' + item.metadata.general.description.none + '</p>');\n\n                            $target.append($html);\n                        });\n                    }\n                }\n            },\n\n            choosePreview: function(item) {\n\n                if ('alternate' in item.manifest && item.manifest.entrypoint) {\n\n                    var alternatebase;\n\n                    if (item.id.indexOf('/content/') >= 0) {\n                        alternatebase = item.id.substr(item.id.indexOf('/content/') + 9);\n                    } else {\n                        alternatebase = item.manifest.entrypoint;\n                    }\n\n                    var alterpath = item.about + '/!/.alternate/' + alternatebase;\n\n                    if (item.manifest.alternate.indexOf('preview.png') >= 0) {\n                        return alterpath + '/preview.png';\n                    } else if (item.manifest.alternate.indexOf('thumb.png') >= 0) {\n                        return alterpath + '/thumb.png';\n                    }\n                }\n\n                return item.about + '.img?s=128';\n            }\n        };\n\n        // Public methods\n        $boasearch.printSuggestions = function(query) {\n\n            for (var request in requestObjects) {\n                if (request && typeof request === 'object') {\n                    request.abort();\n                }\n            }\n\n            $boasearchSuggestions.customReset();\n            requestObjects = [];\n\n            var uri = $boasearch.conf.apiuri;\n            uri = uri.substr(0, uri.indexOf('/resources'));\n            uri += '/queries.json';\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.suggestionsSize\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                var filters = $boasearch.conf.filters.join(' AND ');\n                params.filter = filters;\n            }\n\n            // Not for specific catalogues yet.\n            var cataloguename = '';\n            requestObjects[requestObjects.length] = $.get(uri, params, function(data) {\n\n                if (data.length > 0) {\n                    data.sort(function(a, b){\n                        return b.size - a.size;\n                    });\n\n                    methods.printItemsMarkup(cataloguename, data, query);\n                }\n            });\n        };\n\n        $boasearch.search = function() {\n\n            var currentTime = Date.now();\n\n            var query = $boasearch.val();\n\n            if(query.length < $boasearch.conf.options.minLetters) {\n                return false;\n            }\n\n            methods.initSearch();\n\n            if (cacheResults[query] && cacheResults[query].timeQuery > (currentTime - $boasearch.conf.options.cacheLife)) {\n                methods.printResultSearch(cacheResults[query].data);\n                return true;\n            }\n\n            cacheResults[query] = {\n                timeQuery: currentTime,\n                data: []\n            };\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.resultsSize,\n                \"(s)\": startRecord\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                $.each($boasearch.conf.filters, function(k, filter) {\n                    if (typeof(filter.value) == 'object') {\n                        $.each(filter.value, function(m, val) {\n                            params['(meta)[' + filter.meta + '][' + m + ']'] = val;\n                        });\n                    }\n                    else {\n                        params['(meta)[' + filter.meta + ']'] = filter.value;\n                    }\n                });\n            }\n\n            $.ajax( {\n                url: $boasearch.conf.apiuri,\n                data: params,\n                dataType: 'json',\n                success: function(data) {\n                    $boasearchSuggestions.empty();\n\n                    if (typeof data === 'object' && data.error) {\n                        $boasearch.conf.events.onerror(data);\n                        data = [];\n                    }\n\n                    if (data.length > 0) {\n                        data.sort(function(a, b) {\n                            return b.size - a.size;\n                        });\n\n                        cacheResults[query].data = data;\n\n                    }\n\n                    methods.printResultSearch(data);\n                },\n                error: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                },\n                fail: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                }\n            });\n\n        };\n\n        $boasearch.searchMore = function() {\n            startRecord += $boasearch.conf.options.resultsSize;\n            $boasearch.search();\n        };\n\n        $boasearch.restart = function() {\n            startRecord = 0;\n        };\n\n        $boasearch.choosePreview = methods.choosePreview;\n\n        //BoA: Initialize\n        methods.init();\n    };\n\n    //BoA: Default Settings\n    $.boasearch.defaults = {\n        apiuri: null,\n        catalogues: [],\n        filters: [],\n        options: {\n            suggestionsSize: 10,\n            resultsSize: 10,\n            minLetters: 3,\n            cacheLife: 60000 // 60 seconds\n        },\n        debug: false,\n        results: {\n            target: null,\n            template: null\n        },\n        events: {\n            onstart: null,\n            onfound: null,\n            onerror: function(error) {\n                console.log('BoASearch - search error');\n                console.log(error);\n                return true;\n            }\n        }\n    };\n\n    //BoA: Plugin Function.\n    $.fn.boasearch = function(params, paramval) {\n        if (params === undefined) { params = {}; }\n        if (typeof params === \"object\") {\n            return this.each(function() {\n                new $.boasearch(this, params);\n            });\n        }\n        else {\n\n            var $boasearch;\n\n            if ('data' in this) {\n                $boasearch = this.data('boasearch');\n            } else {\n\n                if ('data' in $(this)) {\n                    $boasearch = $(this).data('boasearch');\n                }\n            }\n\n            if ($boasearch) {\n\n                switch (params) {\n                    case \"search\": $boasearch.search(); break;\n                    case \"nextsearch\": $boasearch.searchMore(); break;\n                    case \"option\": return $boasearch.conf.options[paramval]; break;\n                    case \"restart\": $boasearch.restart(); break;\n                    case \"choosePreview\": return $boasearch.choosePreview(paramval); break;\n                }\n            } else {\n                console.log('Error in boasearch object');\n            }\n        }\n    };\n\n    var chooseview = function(data) {\n\n        var $res;\n\n        // If it is a external resource.\n        if (data.manifest.conexion_type && data.manifest.conexion_type == 'external') {\n            $res = $('<iframe></iframe>');\n            $res.attr('src', data.manifest.url);\n\n            var $reslink = $('<p><a target=\"_blank\"></a></p>');\n            $reslink.find('a').attr('href', data.manifest.url).html(data.manifest.url);\n\n            return $res.get(0).outerHTML + $reslink.get(0).outerHTML;\n        }\n\n        if (data.metadata.technical && data.metadata.technical.format) {\n\n            if (data.metadata.technical.format.match(/pdf/gi) ||\n                    data.metadata.technical.format.match(/html/gi) ||\n                    data.metadata.technical.format.match(/tepuy/gi)) {\n                $res = $('<iframe></iframe>');\n                $res.attr('src', data.about + '/!/').attr('type', data.metadata.technical.format);\n\n            } else {\n\n                var src = '';\n                var alternatebase;\n                if (data.id.indexOf('/content/') >= 0) {\n                    alternatebase = data.id.substr(data.id.indexOf('/content/') + 9);\n                } else {\n                    alternatebase = data.manifest.entrypoint;\n                }\n\n                if (data.manifest.alternate && data.manifest.entrypoint) {\n                    var alterpath = data.about + '/!/.alternate/' + alternatebase + '/';\n                    var name = '';\n\n                    if (data.metadata.technical.format.match(/video/gi) ||\n                            data.metadata.technical.format.match(/audio/gi) ||\n                            data.metadata.technical.format.match(/image/gi)) {\n\n                        if (typeof(data.manifest.alternate) == 'object') {\n                            name = data.manifest.alternate.find(e => /small/g.test(e));\n\n                            if (name) {\n                                src = alterpath + name;\n                            } else {\n                                name = data.manifest.alternate.find(e => /medium/g.test(e));\n                                if (name) {\n                                    src = alterpath + name;\n                                } else {\n                                    src = data.about + '/!/' + data.manifest.entrypoint;\n                                }\n                            }\n                        } else {\n                            src = data.about + '/!/' + data.manifest.entrypoint;\n                        }\n                    } else {\n                        name = typeof(data.manifest.alternate) == 'object' ?\n                                        data.manifest.alternate.find(e => /thumb/g.test(e)) : '';\n                        if (name) {\n                            src = alterpath + name;\n                        } else {\n                            src = data.manifest.customicon;\n                        }\n                    }\n\n\n                } else {\n                    if ('technical' in data.metadata && 'format' in data.metadata.technical &&\n                            (data.metadata.technical.format.match(/video/gi) ||\n                            data.metadata.technical.format.match(/audio/gi) ||\n                            data.metadata.technical.format.match(/image/gi))) {\n                        src = data.about + '/!/';\n                    } else {\n                        src = data.manifest.customicon;\n                    }\n                }\n\n                if (data.metadata.technical.format.match(/video/gi)) {\n                    $res = $('<video controls><source></source></video>');\n                    $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n                } else if (data.metadata.technical.format.match(/audio/gi)) {\n                    $res = $('<audio controls><source></source></audio>');\n                    $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n                } else {\n                    $res = $('<img />');\n                    $res.attr('src', src).attr('alt', data.metadata.general.title.none);\n                }\n\n            }\n\n            return $res.get(0).outerHTML;\n        }\n\n        return $res;\n    };\n\n    var isdownloadable = function(data) {\n        //ToDo: validate by content type.\n        return !data.manifest.conexion_type || data.manifest.conexion_type != 'external';\n    };\n\n    var showmessage = function(text, type, info, asreturn) {\n        type = type ? type : 'error';\n        info = info ? info : '';\n\n        var content = $('#boa-tpl-error-item')[0].innerHTML;\n\n        content = content.replace(/{message}/g, text);\n        content = content.replace(/{info}/g, info);\n        content = content.replace(/{type}/g, type);\n\n        if (asreturn) {\n            return content;\n        } else {\n            if ($errorBox) {\n                $errorBox.html(content);\n            } else {\n                console.log(content);\n            }\n        }\n    };\n\n    var itemcontent = function(item) {\n\n        var content = $('#boa-tpl-item')[0].innerHTML;\n\n        content = content.replace(/{thumb}/g, item.thumb);\n        content = content.replace(/{title}/g, item.metadata.general.title.none);\n        content = content.replace(/{about}/g, item.about);\n        content = content.replace(/{description}/g, item.metadata.general.description.none);\n        content = content.replace(/{comments}/g, item.social.comments);\n        content = content.replace(/{score}/g, item.social.score.count ? item.social.score.sum + '/' + item.social.score.count : 0);\n        content = content.replace(/{views}/g, item.social.views);\n\n        return content;\n    };\n\n    /**\n     * Initialise all for the block.\n     *\n     */\n    var init = function(blockid, boauri, pagesize, socialnetworks) {\n\n        pagesize = pagesize ? pagesize : 10;\n\n        $('#' + blockid).each(function() {\n            var $_this = $(this);\n            var $searchResult = $_this.find('[data-control=\"search-result\"]');\n            var $boaSearch = $_this.find('[data-control=\"search-text\"]');\n\n            $errorBox = $_this.find('[data-control=\"errors-box\"]');\n\n            $_this.find('[data-control=\"search-button\"]').on('click', function(){\n                $_this.find('> .search-result').empty();\n                $boaSearch.boasearch('restart');\n                $boaSearch.boasearch('search');\n            });\n\n            $boaSearch.boasearch({\n                apiuri: boauri,\n                catalogues: [],\n                filters: [],\n                options: {\n                    cacheLife: 2000,\n                    resultsSize: pagesize\n                },\n                events: {\n                    onstart: function(more) {\n                        $searchResult.addClass('loading');\n                        $searchResult.show();\n\n                        if (!more) {\n                            $searchResult.find('> .boa-content').empty();\n                        }\n                    },\n                    onfound: function(data, start) {\n\n                        $searchResult.removeClass('loading');\n                        var $target = $searchResult.find('> .boa-content');\n\n                        var resultsSize = $boaSearch.boasearch('option', 'resultsSize');\n\n                        if (data.length === 0 || data.length < resultsSize) {\n                            $searchResult.find('> button').hide();\n                        }\n                        else {\n                            $searchResult.find('> button').show();\n                        }\n\n                        if (start == 0) {\n                            $_this.find('[data-control=\"show-one\"]').empty();\n                        }\n\n                        if ((!data || data.length === 0) && start == 0) {\n                            $target.empty();\n\n                            var content = showmessage('No se encontraron resultados', 'error', '', true);\n\n                            $target.append(content);\n                            return;\n                        }\n\n                        $.each(data, function(k, item) {\n                            if (item.manifest.conexion_type == 'external') {\n                                item.finaluri = item.manifest.url;\n                            }\n                            else {\n                                item.finaluri = item.about + '/!/';\n\n                                if (item.manifest.entrypoint) {\n                                    item.finaluri += item.manifest.entrypoint;\n                                }\n                            }\n\n                            item.thumb = $boaSearch.boasearch('choosePreview', item);\n\n                            var $item = $(itemcontent(item));\n                            $item.appendTo($target);\n\n                            $item.find('[boa-href]').on('click', function() {\n                                var $this = $(this);\n\n                                var modalresource = $this.data('modal');\n\n                                if (modalresource) {\n                                    modalresource.show();\n                                    return;\n                                }\n\n                                var request = $.get($this.attr('boa-href'))\n                                    .then(function( data ) {\n\n                                        data.custom = {};\n                                        data.custom.preview = chooseview(data);\n                                        data.custom.type = (data.metadata.technical && data.metadata.technical.format) ?\n                                                                data.metadata.technical.format : '';\n                                        data.custom.score = 'avg' in data.social.score ?\n                                                                data.social.score.avg + ' / ' + data.social.score.count : 0;\n                                        data.custom.downloadable = isdownloadable(data);\n\n                                        var socialnetworksitems = [];\n                                        $.each(socialnetworks, function(i, v) {\n                                            var url = v.url.replace('{url}', encodeURI(data.about + '/!/'));\n                                            url = url.replace('{name}', data.metadata.general.title.none);\n\n                                            var item = {};\n                                            item.url = url;\n                                            item.icon = v.icon;\n                                            socialnetworksitems.push(item);\n                                        });\n\n                                        data.custom.socialnetworks = socialnetworksitems;\n\n                                        data.custom.alternates = [];\n                                        $.each(data.manifest.alternate, function(i, alt) {\n                                            var str;\n                                            var strkey = 'alternate_' + alt.substring(0, alt.indexOf('.'));\n\n                                            if (strkey in M.str.block_boasearch) {\n                                                str = M.str.block_boasearch['alternate_' + alt.substring(0, alt.indexOf('.'))];\n                                            } else {\n                                                str = alt;\n                                            }\n\n                                            var one = {\n                                                \"text\": str,\n                                                \"url\": data.about + '/!/.alternate/' + data.manifest.entrypoint + '/' + alt\n                                            };\n\n                                            data.custom.alternates[data.custom.alternates.length] = one;\n                                        });\n\n                                        if (typeof(data.metadata.general.keywords.none) == 'object') {\n                                            data.metadata.general.keywords.none = data.metadata.general.keywords.none.join(', ');\n                                        }\n\n                                        var template = Templates.render('block_boasearch/viewresource', data)\n                                            .then(function(html) {\n                                                modalresource.setTitle(data.metadata.general.title.none);\n\n                                                var $html = $(html);\n\n                                                $html.find('[boa-act=\"rate\"]').on('click', function() {\n                                                    var $rate = $(this);\n\n                                                    var params = { value: $rate.data('value') };\n\n                                                    $.post(data.about + '/scores', params, function() {})\n                                                        .done(function() {\n                                                            $html.find('[boa-act=\"rate\"]').\n                                                                removeClass('active').each(function(key, element) {\n                                                                    var $element = $(element);\n\n                                                                    if ($element.data('value') <= $rate.data('value')) {\n                                                                        $element.addClass('active');\n                                                                    }\n                                                                }\n                                                            );\n                                                        }\n                                                    );\n\n                                                });\n\n                                                return $html;\n                                            });\n\n                                        return template.promise();\n                                    }\n                                );\n\n                                ModalFactory.create({\n                                    body: request.promise()\n                                })\n                                .then(function(modal) {\n                                    modalresource = modal;\n                                    modal.getModal().addClass('block_boasearch-modal');\n                                    modal.show();\n\n                                    var root = modal.getRoot();\n                                    root.on(ModalEvents.hidden, function() {\n\n                                        // Stop audio and video when close the window.\n                                        $(modal.getBody()).find('video').each(function() {\n                                            this.pause();\n                                        });\n\n                                        $(modal.getBody()).find('audio').each(function() {\n                                            this.pause();\n                                        });\n\n                                        $(modal.getBody()).find('iframe').each(function() {\n                                            let $iframe = $(this);\n                                            $iframe.attr('src', 'about:blank');\n                                            $this.data('modal', null);\n                                        });\n                                    });\n\n                                    $this.data('modal', modalresource);\n                                });\n\n                            });\n                        });\n                    },\n                    onerror: function(error) {\n                        var $target = $errorBox;\n                        $target.empty();\n\n                        var $node = showmessage(error.message, 'error', error.info, true);\n                        $target.append($node);\n\n                        $node.find('button.close').on('click', function() {\n                            $node.remove();\n                        });\n\n                        console.log(error);\n\n                        $target.removeClass('loading');\n                    }\n                }\n            });\n\n            $searchResult.find('> button').on('click', function(){\n                $boaSearch.boasearch('nextsearch');\n            });\n\n        });\n\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"main.min.js"}